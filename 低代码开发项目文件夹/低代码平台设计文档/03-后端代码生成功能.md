# 后端Java代码生成功能详细设计

## 🏗️ 数据模型设计器

### 1.1 实体关系图（ERD）设计
```
✅ 可视化建模：
- 拖拽式实体创建
- 实体关系连线绘制
- 一对一、一对多、多对多关系
- 继承关系设计
- 实体分组和模块划分
- ERD图导出（PNG/PDF/SVG）
```

### 1.2 实体属性配置
```
✅ 字段设计：
- 字段名称和类型设置
- 主键、外键标识
- 非空、唯一约束
- 默认值设置
- 字段注释和描述
- 字段长度和精度
- 索引配置
```

### 1.3 Java实体类生成
```
✅ 实体代码生成：
- JPA Entity注解
- Lombok注解支持
- 字段getter/setter方法
- toString/equals/hashCode方法
- 构造函数生成
- 字段验证注解（@NotNull, @Size等）
- Swagger API文档注解
```

#### 实体类生成示例：
```java
package com.example.entity;

import lombok.Data;
import lombok.EqualsAndHashCode;
import com.baomidou.mybatisplus.annotation.*;
import io.swagger.v3.oas.annotations.media.Schema;
import jakarta.validation.constraints.*;
import java.time.LocalDateTime;

/**
 * 用户实体类
 * 
 * @author 低代码平台自动生成
 * @since 2024-01-01
 */
@Data
@EqualsAndHashCode(callSuper = false)
@TableName("sys_user")
@Schema(name = "User", description = "用户信息")
public class User {

    @Schema(description = "用户ID")
    @TableId(value = "id", type = IdType.ASSIGN_ID)
    private Long id;

    @Schema(description = "用户名")
    @TableField("username")
    @NotBlank(message = "用户名不能为空")
    @Size(min = 3, max = 20, message = "用户名长度必须在3-20个字符之间")
    private String username;

    @Schema(description = "邮箱")
    @TableField("email")
    @NotBlank(message = "邮箱不能为空")
    @Email(message = "邮箱格式不正确")
    private String email;

    @Schema(description = "手机号")
    @TableField("phone")
    @Pattern(regexp = "^1[3-9]\\d{9}$", message = "手机号格式不正确")
    private String phone;

    @Schema(description = "状态：0-禁用，1-启用")
    @TableField("status")
    @NotNull(message = "状态不能为空")
    private Integer status;

    @Schema(description = "创建时间")
    @TableField(value = "create_time", fill = FieldFill.INSERT)
    private LocalDateTime createTime;

    @Schema(description = "更新时间")
    @TableField(value = "update_time", fill = FieldFill.INSERT_UPDATE)
    private LocalDateTime updateTime;

    @Schema(description = "是否删除：0-未删除，1-已删除")
    @TableField("deleted")
    @TableLogic
    private Integer deleted;
}
```

## 🔧 Spring Boot项目生成

### 2.1 项目结构生成
```
✅ 目录结构：
src/main/java/com/example/
├── controller/          # 控制器层
│   ├── BaseController.java
│   └── UserController.java
├── service/            # 业务逻辑层
│   ├── IUserService.java
│   └── impl/
│       └── UserServiceImpl.java
├── mapper/             # 数据访问层
│   └── UserMapper.java
├── entity/             # 实体类
│   └── User.java
├── dto/               # 数据传输对象
│   ├── UserDTO.java
│   └── UserQueryDTO.java
├── vo/                # 视图对象
│   └── UserVO.java
├── config/            # 配置类
│   ├── MyBatisPlusConfig.java
│   ├── SwaggerConfig.java
│   └── WebConfig.java
├── exception/         # 异常处理
│   ├── GlobalExceptionHandler.java
│   └── BusinessException.java
├── common/            # 公共类
│   ├── Result.java
│   ├── PageResult.java
│   └── Constants.java
└── utils/             # 工具类
    ├── DateUtils.java
    └── StringUtils.java
```

### 2.2 Maven配置生成
```xml
<?xml version="1.0" encoding="UTF-8"?>
<project xmlns="http://maven.apache.org/POM/4.0.0"
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 
         http://maven.apache.org/xsd/maven-4.0.0.xsd">
    <modelVersion>4.0.0</modelVersion>
    
    <parent>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter-parent</artifactId>
        <version>3.2.0</version>
        <relativePath/>
    </parent>
    
    <groupId>com.example</groupId>
    <artifactId>lowcode-backend</artifactId>
    <version>1.0.0</version>
    <name>lowcode-backend</name>
    <description>低代码平台后端服务</description>
    
    <properties>
        <java.version>17</java.version>
        <mybatis-plus.version>3.5.5</mybatis-plus.version>
        <knife4j.version>4.4.0</knife4j.version>
    </properties>
    
    <dependencies>
        <!-- Spring Boot Starter -->
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-web</artifactId>
        </dependency>
        
        <!-- Spring Boot Validation -->
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-validation</artifactId>
        </dependency>
        
        <!-- MyBatis Plus -->
        <dependency>
            <groupId>com.baomidou</groupId>
            <artifactId>mybatis-plus-boot-starter</artifactId>
            <version>${mybatis-plus.version}</version>
        </dependency>
        
        <!-- MySQL Driver -->
        <dependency>
            <groupId>com.mysql</groupId>
            <artifactId>mysql-connector-j</artifactId>
            <scope>runtime</scope>
        </dependency>
        
        <!-- Redis -->
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-data-redis</artifactId>
        </dependency>
        
        <!-- Lombok -->
        <dependency>
            <groupId>org.projectlombok</groupId>
            <artifactId>lombok</artifactId>
            <optional>true</optional>
        </dependency>
        
        <!-- Knife4j API文档 -->
        <dependency>
            <groupId>com.github.xiaoymin</groupId>
            <artifactId>knife4j-openapi3-jakarta-spring-boot-starter</artifactId>
            <version>${knife4j.version}</version>
        </dependency>
    </dependencies>
</project>
```

### 2.3 配置文件生成
```yaml
# application.yml
server:
  port: 8080
  servlet:
    context-path: /api

spring:
  application:
    name: lowcode-backend
  
  # 数据源配置
  datasource:
    driver-class-name: com.mysql.cj.jdbc.Driver
    url: jdbc:mysql://localhost:3306/lowcode?useUnicode=true&characterEncoding=UTF-8&serverTimezone=Asia/Shanghai
    username: root
    password: root123456
    hikari:
      maximum-pool-size: 20
      minimum-idle: 5
      connection-timeout: 30000
      idle-timeout: 600000
      max-lifetime: 1800000
  
  # Redis配置
  data:
    redis:
      host: localhost
      port: 6379
      password: 
      database: 0
      timeout: 5000
      lettuce:
        pool:
          max-active: 20
          max-idle: 10
          min-idle: 5
  
  # Jackson配置
  jackson:
    date-format: yyyy-MM-dd HH:mm:ss
    time-zone: GMT+8

# MyBatis Plus配置
mybatis-plus:
  configuration:
    map-underscore-to-camel-case: true
    cache-enabled: false
    call-setters-on-nulls: true
    jdbc-type-for-null: 'null'
  global-config:
    db-config:
      id-type: ASSIGN_ID
      logic-delete-field: deleted
      logic-delete-value: 1
      logic-not-delete-value: 0
    banner: false
  mapper-locations: classpath*:/mapper/**/*.xml

# Knife4j配置
knife4j:
  enable: true
  openapi:
    title: 低代码平台API文档
    description: 低代码平台后端接口文档
    version: 1.0.0
    contact:
      name: 开发团队
      email: dev@example.com

# 日志配置
logging:
  level:
    com.example: debug
    org.springframework.web: info
  pattern:
    console: "%d{yyyy-MM-dd HH:mm:ss} [%thread] %-5level %logger{50} - %msg%n"
```

## 🌐 RESTful API生成

### 3.1 Controller层代码生成
```java
package com.example.controller;

import com.example.common.Result;
import com.example.common.PageResult;
import com.example.dto.UserDTO;
import com.example.dto.UserQueryDTO;
import com.example.service.IUserService;
import com.example.vo.UserVO;
import io.swagger.v3.oas.annotations.Operation;
import io.swagger.v3.oas.annotations.Parameter;
import io.swagger.v3.oas.annotations.tags.Tag;
import lombok.RequiredArgsConstructor;
import org.springframework.validation.annotation.Validated;
import org.springframework.web.bind.annotation.*;

import jakarta.validation.Valid;
import jakarta.validation.constraints.NotNull;

/**
 * 用户管理控制器
 *
 * @author 低代码平台自动生成
 * @since 2024-01-01
 */
@Tag(name = "用户管理", description = "用户相关操作接口")
@RestController
@RequestMapping("/user")
@RequiredArgsConstructor
@Validated
public class UserController {

    private final IUserService userService;

    @Operation(summary = "分页查询用户列表")
    @GetMapping("/page")
    public Result<PageResult<UserVO>> getUserPage(
            @Parameter(description = "查询条件") UserQueryDTO queryDTO) {
        return Result.success(userService.getUserPage(queryDTO));
    }

    @Operation(summary = "根据ID查询用户详情")
    @GetMapping("/{id}")
    public Result<UserVO> getUserById(
            @Parameter(description = "用户ID") @PathVariable @NotNull Long id) {
        return Result.success(userService.getUserById(id));
    }

    @Operation(summary = "新增用户")
    @PostMapping
    public Result<Void> createUser(
            @Parameter(description = "用户信息") @RequestBody @Valid UserDTO userDTO) {
        userService.createUser(userDTO);
        return Result.success();
    }

    @Operation(summary = "更新用户信息")
    @PutMapping("/{id}")
    public Result<Void> updateUser(
            @Parameter(description = "用户ID") @PathVariable @NotNull Long id,
            @Parameter(description = "用户信息") @RequestBody @Valid UserDTO userDTO) {
        userService.updateUser(id, userDTO);
        return Result.success();
    }

    @Operation(summary = "删除用户")
    @DeleteMapping("/{id}")
    public Result<Void> deleteUser(
            @Parameter(description = "用户ID") @PathVariable @NotNull Long id) {
        userService.deleteUser(id);
        return Result.success();
    }

    @Operation(summary = "批量删除用户")
    @DeleteMapping("/batch")
    public Result<Void> batchDeleteUsers(
            @Parameter(description = "用户ID列表") @RequestBody @Valid List<Long> ids) {
        userService.batchDeleteUsers(ids);
        return Result.success();
    }

    @Operation(summary = "启用/禁用用户")
    @PutMapping("/{id}/status")
    public Result<Void> updateUserStatus(
            @Parameter(description = "用户ID") @PathVariable @NotNull Long id,
            @Parameter(description = "状态：0-禁用，1-启用") @RequestParam @NotNull Integer status) {
        userService.updateUserStatus(id, status);
        return Result.success();
    }
}
```

### 3.2 Service业务层代码生成
```java
package com.example.service;

import com.example.common.PageResult;
import com.example.dto.UserDTO;
import com.example.dto.UserQueryDTO;
import com.example.vo.UserVO;
import java.util.List;

/**
 * 用户服务接口
 *
 * @author 低代码平台自动生成
 * @since 2024-01-01
 */
public interface IUserService {

    /**
     * 分页查询用户列表
     *
     * @param queryDTO 查询条件
     * @return 分页结果
     */
    PageResult<UserVO> getUserPage(UserQueryDTO queryDTO);

    /**
     * 根据ID查询用户详情
     *
     * @param id 用户ID
     * @return 用户详情
     */
    UserVO getUserById(Long id);

    /**
     * 新增用户
     *
     * @param userDTO 用户信息
     */
    void createUser(UserDTO userDTO);

    /**
     * 更新用户信息
     *
     * @param id 用户ID
     * @param userDTO 用户信息
     */
    void updateUser(Long id, UserDTO userDTO);

    /**
     * 删除用户
     *
     * @param id 用户ID
     */
    void deleteUser(Long id);

    /**
     * 批量删除用户
     *
     * @param ids 用户ID列表
     */
    void batchDeleteUsers(List<Long> ids);

    /**
     * 更新用户状态
     *
     * @param id 用户ID
     * @param status 状态
     */
    void updateUserStatus(Long id, Integer status);
}
```

```java
package com.example.service.impl;

import com.baomidou.mybatisplus.core.conditions.query.LambdaQueryWrapper;
import com.baomidou.mybatisplus.core.conditions.update.LambdaUpdateWrapper;
import com.baomidou.mybatisplus.extension.plugins.pagination.Page;
import com.example.common.PageResult;
import com.example.dto.UserDTO;
import com.example.dto.UserQueryDTO;
import com.example.entity.User;
import com.example.exception.BusinessException;
import com.example.mapper.UserMapper;
import com.example.service.IUserService;
import com.example.vo.UserVO;
import lombok.RequiredArgsConstructor;
import org.springframework.beans.BeanUtils;
import org.springframework.stereotype.Service;
import org.springframework.transaction.annotation.Transactional;
import org.springframework.util.StringUtils;

import java.util.List;
import java.util.stream.Collectors;

/**
 * 用户服务实现类
 *
 * @author 低代码平台自动生成
 * @since 2024-01-01
 */
@Service
@RequiredArgsConstructor
public class UserServiceImpl implements IUserService {

    private final UserMapper userMapper;

    @Override
    public PageResult<UserVO> getUserPage(UserQueryDTO queryDTO) {
        // 构建查询条件
        LambdaQueryWrapper<User> queryWrapper = new LambdaQueryWrapper<>();
        queryWrapper.like(StringUtils.hasText(queryDTO.getUsername()), 
                          User::getUsername, queryDTO.getUsername())
                   .like(StringUtils.hasText(queryDTO.getEmail()), 
                         User::getEmail, queryDTO.getEmail())
                   .eq(queryDTO.getStatus() != null, 
                       User::getStatus, queryDTO.getStatus())
                   .between(queryDTO.getStartTime() != null && queryDTO.getEndTime() != null,
                           User::getCreateTime, queryDTO.getStartTime(), queryDTO.getEndTime())
                   .orderByDesc(User::getCreateTime);

        // 分页查询
        Page<User> page = new Page<>(queryDTO.getCurrent(), queryDTO.getSize());
        Page<User> userPage = userMapper.selectPage(page, queryWrapper);

        // 转换为VO
        List<UserVO> userVOList = userPage.getRecords().stream()
                .map(this::convertToVO)
                .collect(Collectors.toList());

        return PageResult.of(userVOList, userPage.getTotal(), 
                           queryDTO.getCurrent(), queryDTO.getSize());
    }

    @Override
    public UserVO getUserById(Long id) {
        User user = userMapper.selectById(id);
        if (user == null) {
            throw new BusinessException("用户不存在");
        }
        return convertToVO(user);
    }

    @Override
    @Transactional(rollbackFor = Exception.class)
    public void createUser(UserDTO userDTO) {
        // 检查用户名是否已存在
        LambdaQueryWrapper<User> queryWrapper = new LambdaQueryWrapper<>();
        queryWrapper.eq(User::getUsername, userDTO.getUsername());
        if (userMapper.selectCount(queryWrapper) > 0) {
            throw new BusinessException("用户名已存在");
        }

        // 检查邮箱是否已存在
        queryWrapper.clear();
        queryWrapper.eq(User::getEmail, userDTO.getEmail());
        if (userMapper.selectCount(queryWrapper) > 0) {
            throw new BusinessException("邮箱已存在");
        }

        User user = new User();
        BeanUtils.copyProperties(userDTO, user);
        userMapper.insert(user);
    }

    @Override
    @Transactional(rollbackFor = Exception.class)
    public void updateUser(Long id, UserDTO userDTO) {
        User existUser = userMapper.selectById(id);
        if (existUser == null) {
            throw new BusinessException("用户不存在");
        }

        User user = new User();
        BeanUtils.copyProperties(userDTO, user);
        user.setId(id);
        userMapper.updateById(user);
    }

    @Override
    @Transactional(rollbackFor = Exception.class)
    public void deleteUser(Long id) {
        User user = userMapper.selectById(id);
        if (user == null) {
            throw new BusinessException("用户不存在");
        }
        userMapper.deleteById(id);
    }

    @Override
    @Transactional(rollbackFor = Exception.class)
    public void batchDeleteUsers(List<Long> ids) {
        userMapper.deleteBatchIds(ids);
    }

    @Override
    @Transactional(rollbackFor = Exception.class)
    public void updateUserStatus(Long id, Integer status) {
        LambdaUpdateWrapper<User> updateWrapper = new LambdaUpdateWrapper<>();
        updateWrapper.eq(User::getId, id)
                    .set(User::getStatus, status);
        userMapper.update(null, updateWrapper);
    }

    /**
     * 实体转换为VO
     */
    private UserVO convertToVO(User user) {
        UserVO userVO = new UserVO();
        BeanUtils.copyProperties(user, userVO);
        return userVO;
    }
}
```

### 3.3 Mapper数据访问层生成
```java
package com.example.mapper;

import com.baomidou.mybatisplus.core.mapper.BaseMapper;
import com.example.entity.User;
import org.apache.ibatis.annotations.Mapper;

/**
 * 用户Mapper接口
 *
 * @author 低代码平台自动生成
 * @since 2024-01-01
 */
@Mapper
public interface UserMapper extends BaseMapper<User> {

}
```

## 🔒 安全和权限模块

### 安全配置生成
```java
package com.example.config;

import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.security.config.annotation.web.builders.HttpSecurity;
import org.springframework.security.config.annotation.web.configuration.EnableWebSecurity;
import org.springframework.security.config.http.SessionCreationPolicy;
import org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder;
import org.springframework.security.crypto.password.PasswordEncoder;
import org.springframework.security.web.SecurityFilterChain;

/**
 * Spring Security配置
 *
 * @author 低代码平台自动生成
 */
@Configuration
@EnableWebSecurity
public class SecurityConfig {

    @Bean
    public PasswordEncoder passwordEncoder() {
        return new BCryptPasswordEncoder();
    }

    @Bean
    public SecurityFilterChain filterChain(HttpSecurity http) throws Exception {
        http.csrf(csrf -> csrf.disable())
            .sessionManagement(session -> 
                session.sessionCreationPolicy(SessionCreationPolicy.STATELESS))
            .authorizeHttpRequests(auth -> auth
                .requestMatchers("/api/auth/**").permitAll()
                .requestMatchers("/doc.html", "/webjars/**", "/v3/api-docs/**").permitAll()
                .anyRequest().authenticated()
            );
        
        return http.build();
    }
}
```

---

> 📝 **说明**: 后端Java代码生成功能通过可视化建模和模板引擎，自动生成完整的Spring Boot项目结构，包括实体类、Controller、Service、Mapper等所有层次的代码，大大提高开发效率。